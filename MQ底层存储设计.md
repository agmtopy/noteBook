# RocketMQ的底层存储设计

引言：
在消息队列系统中对数据存储都采用都是Logging(日志文件系统)来实现，而没有采用RDMS中的数据文件或者KV结构来记录。

## RocketMQ需要什么样的数据存储设计？
RocketMQ/Kafka是对之前ActiveMQ功能不足对优化，因此为来解决之前对历史问题，所以需要对底层存储系统需要有以下这些特性

1. 功能足够简单，无需update以及需要计算等功能
2. 需要支持高性能、高并发、高可用等特性


## 硬件理论基础

- 读写顺序
  1. 随机读写
  2. 顺序读写

- 硬件性能差异
  1. 内存
  2. 磁盘
  
在传统的物理磁盘中由于需要进行寻道操作因此导致随机读写速度较慢
在SSD的设计中通过主控来替代来寻址的操作，因此速度比传统的磁盘更快，这里来有一个因素也会影响磁盘的读写数据，也就是磁盘的接口协议。
最新的Pcie5的规范中，读取速度可达到12Gb/S,未来的Pcie6中，速度可用达到32Gb/s


## 现有的数据存储现状
由于硬件限制，在系统设计上只能对读写进行一个取舍，要么以’读‘为基础，要么以‘写’为基础进行系统设计。

- 不同的方向
  1. 以读为基础的设计，主要的实现是MySQL、Oracle。底层采用索引结构，在写入时需要维护索引结构，以便在读取时使用
  2. 第二种是以写为基础的设计，主要实现是BigTable、HBase、RocksDB。底层采用顺序写入日志文件，牺牲查询性能来换取高性能的读写设计


## RocketMQ/Kafka的实现
  
- 数据文件
  数据文件用顺序写的方式进行写入，但是这样不能解决查询的效率问题。解决查询效率问题可以使用索引来解决，索引以两个处理方案一个是Tree方案
  
  
  
[参考文章](https://www.heapdump.cn/article/3018544)
  
